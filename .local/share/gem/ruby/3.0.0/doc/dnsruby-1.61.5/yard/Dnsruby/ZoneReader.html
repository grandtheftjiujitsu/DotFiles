<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Dnsruby::ZoneReader
  
    &mdash; Documentation by YARD 0.9.26
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Dnsruby::ZoneReader";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (Z)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Dnsruby.html" title="Dnsruby (module)">Dnsruby</a></span></span>
     &raquo; 
    <span class="title">ZoneReader</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Dnsruby::ZoneReader
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Dnsruby::ZoneReader</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/dnsruby/zone_reader.rb</dd>
  </dl>
  
</div>

<h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="ZoneReader/ParseException.html" title="Dnsruby::ZoneReader::ParseException (class)">ParseException</a></span>
    
  
</p>







  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_ttl-instance_method" title="#get_ttl (instance method)">#<strong>get_ttl</strong>(ttl_text_in)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get the TTL in seconds from the m, h, d, w format.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(origin, soa_minimum = nil, soa_ttl = nil)  &#x21d2; ZoneReader </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create a new ZoneReader.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#normalise_line-instance_method" title="#normalise_line (instance method)">#<strong>normalise_line</strong>(line, do_prefix_hack = false)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Take a line from the input zone file, and return the normalised form  do_prefix_hack should always be false.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#prefix_for_rrset_order-instance_method" title="#prefix_for_rrset_order (instance method)">#<strong>prefix_for_rrset_order</strong>(type, type_was)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This method is included only for OpenDNSSEC support.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_file-instance_method" title="#process_file (instance method)">#<strong>process_file</strong>(source)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Takes a filename string, or any type of IO object, and attempts to load a zone.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_io-instance_method" title="#process_io (instance method)">#<strong>process_io</strong>(io)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Iterate over each line in a IO object, and process it.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_line-instance_method" title="#process_line (instance method)">#<strong>process_line</strong>(line, do_prefix_hack = false)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Process the next line of the file  Returns a string representing the normalised line.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_quotes-instance_method" title="#process_quotes (instance method)">#<strong>process_quotes</strong>(section)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#replace_soa_ttl_fields-instance_method" title="#replace_soa_ttl_fields (instance method)">#<strong>replace_soa_ttl_fields</strong>(line)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#strip_comments-instance_method" title="#strip_comments (instance method)">#<strong>strip_comments</strong>(line)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#strip_comments_meticulously-instance_method" title="#strip_comments_meticulously (instance method)">#<strong>strip_comments_meticulously</strong>(line)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(origin, soa_minimum = nil, soa_ttl = nil)  &#x21d2; <tt><span class='object_link'><a href="" title="Dnsruby::ZoneReader (class)">ZoneReader</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create a new ZoneReader. The zone origin is required. If the desired SOA minimum</p>

<pre class="code ruby"><code class="ruby">and TTL are passed in, then they are used as default values.
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/dnsruby/zone_reader.rb', line 27</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_origin'>origin</span><span class='comma'>,</span> <span class='id identifier rubyid_soa_minimum'>soa_minimum</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_soa_ttl'>soa_ttl</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='ivar'>@origin</span> <span class='op'>=</span> <span class='id identifier rubyid_origin'>origin</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>

  <span class='kw'>if</span> <span class='lparen'>(</span><span class='op'>!</span><span class='const'><span class='object_link'><a href="Name.html" title="Dnsruby::Name (class)">Name</a></span></span><span class='period'>.</span><span class='id identifier rubyid_create'><span class='object_link'><a href="Name.html#create-class_method" title="Dnsruby::Name.create (method)">create</a></span></span><span class='lparen'>(</span><span class='ivar'>@origin</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_absolute?'>absolute?</span><span class='rparen'>)</span>
    <span class='ivar'>@origin</span> <span class='op'>=</span> <span class='ivar'>@origin</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='ivar'>@soa_ttl</span> <span class='op'>=</span> <span class='id identifier rubyid_soa_ttl'>soa_ttl</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_soa_minimum'>soa_minimum</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='ivar'>@last_explicit_ttl</span><span class='rparen'>)</span>
    <span class='ivar'>@last_explicit_ttl</span> <span class='op'>=</span> <span class='id identifier rubyid_soa_minimum'>soa_minimum</span>
  <span class='kw'>else</span>
    <span class='ivar'>@last_explicit_ttl</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>end</span>
  <span class='ivar'>@last_explicit_class</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Classes.html" title="Dnsruby::Classes (class)">Classes</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="CodeMapper.html#initialize-instance_method" title="Dnsruby::CodeMapper#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>IN</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@last_name</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@continued_line</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@in_quoted_section</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="get_ttl-instance_method">
  
    #<strong>get_ttl</strong>(ttl_text_in)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get the TTL in seconds from the m, h, d, w format</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/dnsruby/zone_reader.rb', line 397</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_ttl'>get_ttl</span><span class='lparen'>(</span><span class='id identifier rubyid_ttl_text_in'>ttl_text_in</span><span class='rparen'>)</span>
  <span class='comment'>#  If no letter afterwards, then in seconds already
</span>  <span class='comment'>#  Could be e.g. &quot;3d4h12m&quot; - unclear if &quot;4h5w&quot; is legal - best assume it is
</span>  <span class='comment'>#  So, search out each letter in the string, and get the number before it.
</span>  <span class='id identifier rubyid_ttl_text'>ttl_text</span> <span class='op'>=</span> <span class='id identifier rubyid_ttl_text_in'>ttl_text_in</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span>
  <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='id identifier rubyid_ttl_text'>ttl_text</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[whdms]</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_index'>index</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_ttl_text'>ttl_text</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_last_index'>last_index</span> <span class='op'>=</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='id identifier rubyid_total'>total</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>while</span> <span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_letter'>letter</span> <span class='op'>=</span> <span class='id identifier rubyid_ttl_text'>ttl_text</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_number'>number</span> <span class='op'>=</span> <span class='id identifier rubyid_ttl_text'>ttl_text</span><span class='lbracket'>[</span><span class='id identifier rubyid_last_index'>last_index</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='op'>-</span><span class='id identifier rubyid_last_index'>last_index</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
    <span class='id identifier rubyid_new_number'>new_number</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_letter'>letter</span>
    <span class='kw'>when</span> <span class='int'>115</span> <span class='kw'>then</span> <span class='comment'># &quot;s&quot;
</span>      <span class='id identifier rubyid_new_number'>new_number</span> <span class='op'>=</span> <span class='id identifier rubyid_number'>number</span>
    <span class='kw'>when</span> <span class='int'>109</span> <span class='kw'>then</span> <span class='comment'># &quot;m&quot;
</span>      <span class='id identifier rubyid_new_number'>new_number</span> <span class='op'>=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>*</span> <span class='int'>60</span>
    <span class='kw'>when</span> <span class='int'>104</span> <span class='kw'>then</span> <span class='comment'># &quot;h&quot;
</span>      <span class='id identifier rubyid_new_number'>new_number</span> <span class='op'>=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>*</span> <span class='int'>3600</span>
    <span class='kw'>when</span> <span class='int'>100</span> <span class='kw'>then</span> <span class='comment'># &quot;d&quot;
</span>      <span class='id identifier rubyid_new_number'>new_number</span> <span class='op'>=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>*</span> <span class='int'>86400</span>
    <span class='kw'>when</span> <span class='int'>119</span> <span class='kw'>then</span> <span class='comment'># &quot;w&quot;
</span>      <span class='id identifier rubyid_new_number'>new_number</span> <span class='op'>=</span> <span class='id identifier rubyid_number'>number</span> <span class='op'>*</span> <span class='int'>604800</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_total'>total</span> <span class='op'>+=</span> <span class='id identifier rubyid_new_number'>new_number</span>

    <span class='id identifier rubyid_last_index'>last_index</span> <span class='op'>=</span> <span class='id identifier rubyid_index'>index</span>
    <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='id identifier rubyid_ttl_text'>ttl_text</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[whdms]</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='id identifier rubyid_last_index'>last_index</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_total'>total</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="normalise_line-instance_method">
  
    #<strong>normalise_line</strong>(line, do_prefix_hack = false)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Take a line from the input zone file, and return the normalised form</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_do_prefix_hack'>do_prefix_hack</span> <span class='id identifier rubyid_should'>should</span> <span class='id identifier rubyid_always'>always</span> <span class='id identifier rubyid_be'>be</span> <span class='kw'>false</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/dnsruby/zone_reader.rb', line 211</span>

<span class='kw'>def</span> <span class='id identifier rubyid_normalise_line'>normalise_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='id identifier rubyid_do_prefix_hack'>do_prefix_hack</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='comment'>#  Note that a freestanding &quot;@&quot; is used to denote the current origin - we can simply replace that straight away
</span>  <span class='comment'>#  Remove the ( and )
</span>  <span class='comment'>#  Note that no domain name may be specified in the RR - in that case, last_name should be used. How do we tell? Tab or space at start of line.
</span>
  <span class='comment'>#  If we have text in the record, then ignore that in the parsing, and stick it on again at the end
</span>  <span class='id identifier rubyid_stored_line'>stored_line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='op'>!=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_stored_line'>stored_line</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='lbracket'>[</span><span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rbracket'>]</span><span class='semicolon'>;</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>||</span> <span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\t</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='ivar'>@last_name</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_line'>line</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_chomp!'>chomp!</span>
  <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s+@$</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='ivar'>@origin</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='comment'># IN CNAME @
</span>  <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^@\s+</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@origin</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='comment'># IN CNAME @
</span>  <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s+@\s+</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='ivar'>@origin</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_strip!'>strip!</span>


  <span class='comment'>#  o We need to identify the domain name in the record, and then
</span>  <span class='id identifier rubyid_split'>split</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='comment'># split on whitespace
</span>  <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_split'>split</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\\</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='id identifier rubyid_ls'>ls</span> <span class='op'>=</span><span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='const'><span class='object_link'><a href="Name.html" title="Dnsruby::Name (class)">Name</a></span></span><span class='period'>.</span><span class='id identifier rubyid_create'><span class='object_link'><a href="Name.html#create-class_method" title="Dnsruby::Name.create (method)">create</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_labels'>labels</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_el'>el</span><span class='op'>|</span> <span class='id identifier rubyid_ls'>ls</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Name.html" title="Dnsruby::Name (class)">Name</a></span></span><span class='period'>.</span><span class='id identifier rubyid_decode'><span class='object_link'><a href="Name.html#decode-class_method" title="Dnsruby::Name.decode (method)">decode</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_el'>el</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_new_name'>new_name</span> <span class='op'>=</span> <span class='id identifier rubyid_ls'>ls</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>


    <span class='kw'>if</span> <span class='lparen'>(</span><span class='op'>!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\.\z</span><span class='regexp_end'>/</span></span> <span class='op'>=~</span> <span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_new_name'>new_name</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='ivar'>@origin</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_new_name'>new_name</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_new_name'>new_name</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span>
    <span class='lparen'>(</span><span class='id identifier rubyid_split'>split</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_line'>line</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_split'>split</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>1</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_line'>line</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_new_name'>new_name</span>
    <span class='id identifier rubyid_split'>split</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span>
    <span class='comment'>#  o add $ORIGIN to it if it is not absolute
</span>  <span class='kw'>elsif</span> <span class='op'>!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\.\z</span><span class='regexp_end'>/</span></span> <span class='op'>=~</span> <span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_new_name'>new_name</span> <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='ivar'>@origin</span>
    <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_new_name'>new_name</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='id identifier rubyid_new_name'>new_name</span>
    <span class='id identifier rubyid_split'>split</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span>
  <span class='kw'>end</span>

  <span class='comment'>#  If the second field is not a number, then we should add the TTL to the line
</span>  <span class='comment'>#  Remember we can get &quot;m&quot; &quot;w&quot; &quot;y&quot; here! So need to check for appropriate regexp...
</span>  <span class='id identifier rubyid_found_ttl_regexp'>found_ttl_regexp</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_split'>split</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='op'>=~</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^[0-9]+[smhdwSMHDW]</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_found_ttl_regexp'>found_ttl_regexp</span> <span class='op'>==</span> <span class='int'>0</span><span class='rparen'>)</span>
    <span class='comment'>#  Replace the formatted ttl with an actual number
</span>    <span class='id identifier rubyid_ttl'>ttl</span> <span class='op'>=</span> <span class='id identifier rubyid_get_ttl'>get_ttl</span><span class='lparen'>(</span><span class='id identifier rubyid_split'>split</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ttl'>ttl</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span>
    <span class='ivar'>@last_explicit_ttl</span> <span class='op'>=</span> <span class='id identifier rubyid_ttl'>ttl</span>
    <span class='lparen'>(</span><span class='id identifier rubyid_split'>split</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>-</span> <span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_line'>line</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_split'>split</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>2</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_line'>line</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_split'>split</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span>
  <span class='kw'>elsif</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_split'>split</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>==</span> <span class='int'>0</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_split'>split</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='comment'>#  Add the TTL
</span>    <span class='kw'>if</span> <span class='lparen'>(</span><span class='op'>!</span><span class='ivar'>@last_explicit_ttl</span><span class='rparen'>)</span>
      <span class='comment'>#  If this is the SOA record, and no @last_explicit_ttl is defined,
</span>      <span class='comment'>#  then we need to try the SOA TTL element from the config. Otherwise,
</span>      <span class='comment'>#  find the SOA Minimum field, and use that.
</span>      <span class='comment'>#  We should also generate a warning to that effect
</span>      <span class='comment'>#  How do we know if it is an SOA record at this stage? It must be, or
</span>      <span class='comment'>#  else @last_explicit_ttl should be defined
</span>      <span class='comment'>#  We could put a marker in the RR for now - and replace it once we know
</span>      <span class='comment'>#  the actual type. If the type is not SOA then, then we can raise an error
</span>      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> %MISSING_TTL% </span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='ivar'>@last_explicit_ttl</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='lparen'>(</span><span class='id identifier rubyid_split'>split</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_line'>line</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_split'>split</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>1</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_line'>line</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_split'>split</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span>
  <span class='kw'>else</span>
    <span class='ivar'>@last_explicit_ttl</span> <span class='op'>=</span> <span class='id identifier rubyid_split'>split</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='kw'>end</span>

  <span class='comment'>#  Now see if the clas is included. If not, then we should default to the last class used.
</span>  <span class='kw'>begin</span>
    <span class='id identifier rubyid_klass'>klass</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Classes.html" title="Dnsruby::Classes (class)">Classes</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="CodeMapper.html#initialize-instance_method" title="Dnsruby::CodeMapper#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_split'>split</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='ivar'>@last_explicit_class</span> <span class='op'>=</span> <span class='id identifier rubyid_klass'>klass</span>
  <span class='kw'>rescue</span> <span class='const'>ArgumentError</span>
    <span class='comment'>#  Wasn&#39;t a CLASS
</span>    <span class='comment'>#  So add the last explicit class in
</span>    <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_line'>line</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_split'>split</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_line'>line</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='ivar'>@last_explicit_class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span>
    <span class='lparen'>(</span><span class='id identifier rubyid_split'>split</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>-</span> <span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_line'>line</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_split'>split</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>2</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_line'>line</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_split'>split</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span>
  <span class='kw'>rescue</span> <span class='const'>Error</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='kw'>end</span>

  <span class='comment'>#  Add the type so we can load the zone one RRSet at a time.
</span>  <span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="CodeMapper.html#initialize-instance_method" title="Dnsruby::CodeMapper#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_split'>split</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_is_soa'>is_soa</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#SOA-constant" title="Dnsruby::Types::SOA (constant)">SOA</a></span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_type_was'>type_was</span> <span class='op'>=</span> <span class='id identifier rubyid_type'>type</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='period'>.</span><span class='const'>RRSIG</span><span class='rparen'>)</span>
    <span class='comment'>#  If this is an RRSIG record, then add the TYPE COVERED rather than the type - this allows us to load a complete RRSet at a time
</span>    <span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="CodeMapper.html#initialize-instance_method" title="Dnsruby::CodeMapper#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_split'>split</span><span class='lbracket'>[</span><span class='int'>4</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_type_string'>type_string</span><span class='op'>=</span><span class='id identifier rubyid_prefix_for_rrset_order'>prefix_for_rrset_order</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_type_was'>type_was</span><span class='rparen'>)</span>
  <span class='ivar'>@last_name</span> <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span>

  <span class='kw'>if</span> <span class='op'>!</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#NAPTR-constant" title="Dnsruby::Types::NAPTR (constant)">NAPTR</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#TXT-constant" title="Dnsruby::Types::TXT (constant)">TXT</a></span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='id identifier rubyid_type_was'>type_was</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_is_soa'>is_soa</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@soa_ttl</span><span class='rparen'>)</span>
      <span class='comment'>#  Replace the %MISSING_TTL% text with the SOA TTL from the config
</span>      <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> %MISSING_TTL% </span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='ivar'>@soa_ttl</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='comment'>#  Can we try the @last_explicit_ttl?
</span>      <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@last_explicit_ttl</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> %MISSING_TTL% </span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='ivar'>@last_explicit_ttl</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_replace_soa_ttl_fields'>replace_soa_ttl_fields</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='op'>!</span><span class='ivar'>@last_explicit_ttl</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_soa_rr'>soa_rr</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Dnsruby.html" title="Dnsruby (module)">Dnsruby</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="RR.html" title="Dnsruby::RR (class)">RR</a></span></span><span class='period'>.</span><span class='id identifier rubyid_create'><span class='object_link'><a href="RR.html#create-class_method" title="Dnsruby::RR.create (method)">create</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span>
      <span class='ivar'>@last_explicit_ttl</span> <span class='op'>=</span> <span class='id identifier rubyid_soa_rr'>soa_rr</span><span class='period'>.</span><span class='id identifier rubyid_minimum'>minimum</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>

  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_stored_line'>stored_line</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_stored_line'>stored_line</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_line'>line</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_stored_line'>stored_line</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>
  <span class='kw'>end</span>

  <span class='comment'>#  We need to fix up any non-absolute names in the RR
</span>  <span class='comment'>#  Some RRs have a single name, at the end of the string -
</span>  <span class='comment'>#    to do these, we can just check the last character for &quot;.&quot; and add the
</span>  <span class='comment'>#    &quot;.&quot; + origin string if necessary
</span>  <span class='kw'>if</span> <span class='lparen'>(</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#MX-constant" title="Dnsruby::Types::MX (constant)">MX</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#NS-constant" title="Dnsruby::Types::NS (constant)">NS</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#AFSDB-constant" title="Dnsruby::Types::AFSDB (constant)">AFSDB</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#NAPTR-constant" title="Dnsruby::Types::NAPTR (constant)">NAPTR</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#RT-constant" title="Dnsruby::Types::RT (constant)">RT</a></span></span><span class='comma'>,</span>
        <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#SRV-constant" title="Dnsruby::Types::SRV (constant)">SRV</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#CNAME-constant" title="Dnsruby::Types::CNAME (constant)">CNAME</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#MB-constant" title="Dnsruby::Types::MB (constant)">MB</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#MG-constant" title="Dnsruby::Types::MG (constant)">MG</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#MR-constant" title="Dnsruby::Types::MR (constant)">MR</a></span></span><span class='comma'>,</span>
        <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#PTR-constant" title="Dnsruby::Types::PTR (constant)">PTR</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#DNAME-constant" title="Dnsruby::Types::DNAME (constant)">DNAME</a></span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='id identifier rubyid_type_was'>type_was</span><span class='rparen'>)</span>
    <span class='comment'>#         if (line[line.length-1, 1] != &quot;.&quot;)
</span>    <span class='kw'>if</span> <span class='lparen'>(</span><span class='op'>!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\.\z</span><span class='regexp_end'>/</span></span> <span class='op'>=~</span> <span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='ivar'>@origin</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='comment'>#  Other RRs have several names. These should be parsed by Dnsruby,
</span>  <span class='comment'>#    and the names adjusted there.
</span>  <span class='kw'>if</span> <span class='lparen'>(</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#MINFO-constant" title="Dnsruby::Types::MINFO (constant)">MINFO</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#PX-constant" title="Dnsruby::Types::PX (constant)">PX</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#RP-constant" title="Dnsruby::Types::RP (constant)">RP</a></span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='id identifier rubyid_type_was'>type_was</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_parsed_rr'>parsed_rr</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Dnsruby.html" title="Dnsruby (module)">Dnsruby</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="RR.html" title="Dnsruby::RR (class)">RR</a></span></span><span class='period'>.</span><span class='id identifier rubyid_create'><span class='object_link'><a href="RR.html#create-class_method" title="Dnsruby::RR.create (method)">create</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_parsed_rr'>parsed_rr</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span>
    <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#MINFO-constant" title="Dnsruby::Types::MINFO (constant)">MINFO</a></span></span>
      <span class='kw'>if</span> <span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_parsed_rr'>parsed_rr</span><span class='period'>.</span><span class='id identifier rubyid_rmailbx'>rmailbx</span><span class='period'>.</span><span class='id identifier rubyid_absolute?'>absolute?</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_parsed_rr'>parsed_rr</span><span class='period'>.</span><span class='id identifier rubyid_rmailbx'>rmailbx</span> <span class='op'>=</span> <span class='id identifier rubyid_parsed_rr'>parsed_rr</span><span class='period'>.</span><span class='id identifier rubyid_rmailbx'>rmailbx</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='ivar'>@origin</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_parsed_rr'>parsed_rr</span><span class='period'>.</span><span class='id identifier rubyid_emailbx'>emailbx</span><span class='period'>.</span><span class='id identifier rubyid_absolute?'>absolute?</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_parsed_rr'>parsed_rr</span><span class='period'>.</span><span class='id identifier rubyid_emailbx'>emailbx</span> <span class='op'>=</span> <span class='id identifier rubyid_parsed_rr'>parsed_rr</span><span class='period'>.</span><span class='id identifier rubyid_emailbx'>emailbx</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='ivar'>@origin</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#PX-constant" title="Dnsruby::Types::PX (constant)">PX</a></span></span>
      <span class='kw'>if</span> <span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_parsed_rr'>parsed_rr</span><span class='period'>.</span><span class='id identifier rubyid_map822'>map822</span><span class='period'>.</span><span class='id identifier rubyid_absolute?'>absolute?</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_parsed_rr'>parsed_rr</span><span class='period'>.</span><span class='id identifier rubyid_map822'>map822</span> <span class='op'>=</span> <span class='id identifier rubyid_parsed_rr'>parsed_rr</span><span class='period'>.</span><span class='id identifier rubyid_map822'>map822</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='ivar'>@origin</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_parsed_rr'>parsed_rr</span><span class='period'>.</span><span class='id identifier rubyid_mapx400'>mapx400</span><span class='period'>.</span><span class='id identifier rubyid_absolute?'>absolute?</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_parsed_rr'>parsed_rr</span><span class='period'>.</span><span class='id identifier rubyid_mapx400'>mapx400</span> <span class='op'>=</span> <span class='id identifier rubyid_parsed_rr'>parsed_rr</span><span class='period'>.</span><span class='id identifier rubyid_mapx400'>mapx400</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='ivar'>@origin</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#RP-constant" title="Dnsruby::Types::RP (constant)">RP</a></span></span>
      <span class='kw'>if</span> <span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_parsed_rr'>parsed_rr</span><span class='period'>.</span><span class='id identifier rubyid_mailbox'>mailbox</span><span class='period'>.</span><span class='id identifier rubyid_absolute?'>absolute?</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_parsed_rr'>parsed_rr</span><span class='period'>.</span><span class='id identifier rubyid_mailbox'>mailbox</span> <span class='op'>=</span> <span class='id identifier rubyid_parsed_rr'>parsed_rr</span><span class='period'>.</span><span class='id identifier rubyid_mailbox'>mailbox</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='ivar'>@origin</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_parsed_rr'>parsed_rr</span><span class='period'>.</span><span class='id identifier rubyid_txtdomain'>txtdomain</span><span class='period'>.</span><span class='id identifier rubyid_absolute?'>absolute?</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_parsed_rr'>parsed_rr</span><span class='period'>.</span><span class='id identifier rubyid_txtdomain'>txtdomain</span> <span class='op'>=</span> <span class='id identifier rubyid_parsed_rr'>parsed_rr</span><span class='period'>.</span><span class='id identifier rubyid_txtdomain'>txtdomain</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='ivar'>@origin</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_parsed_rr'>parsed_rr</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_do_prefix_hack'>do_prefix_hack</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_line'>line</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_type_string'>type_string</span><span class='comma'>,</span> <span class='ivar'>@last_name</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_line'>line</span><span class='op'>+</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="prefix_for_rrset_order-instance_method">
  
    #<strong>prefix_for_rrset_order</strong>(type, type_was)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This method is included only for OpenDNSSEC support. It should not be</p>

<pre class="code ruby"><code class="ruby">used otherwise.
Frig the RR type so that NSEC records appear last in the RRSets.
Also make sure that DNSKEYs come first (so we have a key to verify
the RRSet with!).
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/dnsruby/zone_reader.rb', line 448</span>

<span class='kw'>def</span> <span class='id identifier rubyid_prefix_for_rrset_order'>prefix_for_rrset_order</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_type_was'>type_was</span><span class='rparen'>)</span> <span class='comment'># :nodoc: all
</span>  <span class='comment'>#  Now make sure that NSEC(3) RRs go to the back of the list
</span>  <span class='kw'>if</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>NSEC</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>NSEC3</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_type_was'>type_was</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#RRSIG-constant" title="Dnsruby::Types::RRSIG (constant)">RRSIG</a></span></span><span class='rparen'>)</span>
      <span class='comment'>#  Get the RRSIG first
</span>      <span class='id identifier rubyid_type_string'>type_string</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ZZ</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_type_string'>type_string</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ZZZ</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span>
    <span class='kw'>end</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_type'>type</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#DNSKEY-constant" title="Dnsruby::Types::DNSKEY (constant)">DNSKEY</a></span></span>
    <span class='id identifier rubyid_type_string'>type_string</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_type'>type</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="Types.html" title="Dnsruby::Types (class)">Types</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Types.html#NS-constant" title="Dnsruby::Types::NS (constant)">NS</a></span></span>
    <span class='comment'>#  Make sure that we see the NS records first so we know the delegation status
</span>    <span class='id identifier rubyid_type_string'>type_string</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_type_string'>type_string</span> <span class='op'>=</span> <span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_type_string'>type_string</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_file-instance_method">
  
    #<strong>process_file</strong>(source)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Takes a filename string, or any type of IO object, and attempts to load a zone.</p>

<pre class="code ruby"><code class="ruby">Returns a list of RRs if successful, nil otherwise.
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


47
48
49
50
51
52
53
54
55</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/dnsruby/zone_reader.rb', line 47</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process_file'>process_file</span><span class='lparen'>(</span><span class='id identifier rubyid_source'>source</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_source'>source</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_file'>file</span><span class='op'>|</span>
      <span class='id identifier rubyid_process_io'>process_io</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_process_io'>process_io</span><span class='lparen'>(</span><span class='id identifier rubyid_source'>source</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_io-instance_method">
  
    #<strong>process_io</strong>(io)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Iterate over each line in a IO object, and process it.</p>

<pre class="code ruby"><code class="ruby">Returns a list of RRs if successful, nil otherwise.
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/dnsruby/zone_reader.rb', line 59</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process_io'>process_io</span><span class='lparen'>(</span><span class='id identifier rubyid_io'>io</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_zone'>zone</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_line'>line</span><span class='op'>|</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_ret'>ret</span> <span class='op'>=</span> <span class='id identifier rubyid_process_line'>process_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_ret'>ret</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_rr'>rr</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="RR.html" title="Dnsruby::RR (class)">RR</a></span></span><span class='period'>.</span><span class='id identifier rubyid_create'><span class='object_link'><a href="RR.html#create-class_method" title="Dnsruby::RR.create (method)">create</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_ret'>ret</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_zone'>zone</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_zone'>zone</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_zone'>zone</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_rr'>rr</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="ZoneReader/ParseException.html" title="Dnsruby::ZoneReader::ParseException (class)">ParseException</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Dnsruby::ZoneReader#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error reading line </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_lineno'>lineno</span><span class='embexpr_end'>}</span><span class='tstring_content'> of </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> : [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_line'>line</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_zone'>zone</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_line-instance_method">
  
    #<strong>process_line</strong>(line, do_prefix_hack = false)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Process the next line of the file</p>

<pre class="code ruby"><code class="ruby">Returns a string representing the normalised line.
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/dnsruby/zone_reader.rb', line 80</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process_line'>process_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='id identifier rubyid_do_prefix_hack'>do_prefix_hack</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_strip_comments'>strip_comments</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>0</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_line'>line</span> <span class='op'>||</span> <span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>0</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='ivar'>@in_quoted_section</span> <span class='op'>=</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@continued_line</span>

  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$ORIGIN</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>==</span> <span class='int'>0</span><span class='rparen'>)</span>
    <span class='ivar'>@origin</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span> <span class='comment'>#  $ORIGIN &lt;domain-name&gt; [&lt;comment&gt;]
</span>    <span class='comment'>#                 print &quot;Setting $ORIGIN to #{@origin}\n&quot;
</span>    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$TTL</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>==</span> <span class='int'>0</span><span class='rparen'>)</span>
    <span class='ivar'>@last_explicit_ttl</span> <span class='op'>=</span> <span class='id identifier rubyid_get_ttl'>get_ttl</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='rparen'>)</span> <span class='comment'>#  $TTL &lt;ttl&gt;
</span>    <span class='comment'>#                 print &quot;Setting $TTL to #{ttl}\n&quot;
</span>    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@continued_line</span><span class='rparen'>)</span>
    <span class='comment'>#  Add the next line until we see a &quot;)&quot;
</span>    <span class='comment'>#  REMEMBER TO STRIP OFF COMMENTS!!!
</span>    <span class='ivar'>@continued_line</span> <span class='op'>=</span> <span class='id identifier rubyid_strip_comments'>strip_comments</span><span class='lparen'>(</span><span class='ivar'>@continued_line</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='ivar'>@continued_line</span><span class='period'>.</span><span class='id identifier rubyid_rstrip'>rstrip</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_line'>line</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='comment'>#  OK
</span>      <span class='ivar'>@continued_line</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_open_bracket'>open_bracket</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_open_bracket'>open_bracket</span><span class='rparen'>)</span>
    <span class='comment'>#  Keep going until we see &quot;)&quot;
</span>    <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_open_bracket'>open_bracket</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='comment'>#  OK
</span>      <span class='ivar'>@continued_line</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>else</span>
      <span class='ivar'>@continued_line</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='ivar'>@continued_line</span>

  <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_strip_comments'>strip_comments</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'>#  If SOA, then replace &quot;3h&quot; etc. with expanded seconds
</span>  <span class='comment'>#       begin
</span>  <span class='kw'>return</span> <span class='id identifier rubyid_normalise_line'>normalise_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='comma'>,</span> <span class='id identifier rubyid_do_prefix_hack'>do_prefix_hack</span><span class='rparen'>)</span>
  <span class='comment'>#       rescue Exception =&gt; e
</span>  <span class='comment'>#         print &quot;ERROR parsing line #{@line_num} : #{line}\n&quot;
</span>  <span class='comment'>#         return &quot;\n&quot;, Types::ANY
</span>  <span class='comment'>#       end
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_quotes-instance_method">
  
    #<strong>process_quotes</strong>(section)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


199
200
201
202
203
204
205
206
207</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/dnsruby/zone_reader.rb', line 199</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process_quotes'>process_quotes</span><span class='lparen'>(</span><span class='id identifier rubyid_section'>section</span><span class='rparen'>)</span>
  <span class='comment'>#  Look through the section of text and set the @in_quoted_section
</span>  <span class='comment'>#  as it should be at the end of the given section
</span>  <span class='id identifier rubyid_last_index'>last_index</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>while</span> <span class='lparen'>(</span><span class='id identifier rubyid_next_index'>next_index</span> <span class='op'>=</span> <span class='id identifier rubyid_section'>section</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_last_index'>last_index</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='ivar'>@in_quoted_section</span> <span class='op'>=</span> <span class='op'>!</span><span class='ivar'>@in_quoted_section</span>
    <span class='id identifier rubyid_last_index'>last_index</span> <span class='op'>=</span> <span class='id identifier rubyid_next_index'>next_index</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="replace_soa_ttl_fields-instance_method">
  
    #<strong>replace_soa_ttl_fields</strong>(line)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


432
433
434
435
436
437
438
439
440
441</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/dnsruby/zone_reader.rb', line 432</span>

<span class='kw'>def</span> <span class='id identifier rubyid_replace_soa_ttl_fields'>replace_soa_ttl_fields</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span>
  <span class='comment'>#  Replace any fields which evaluate to 0
</span>  <span class='id identifier rubyid_split'>split</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span>
  <span class='int'>4</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_x'>x</span> <span class='op'>=</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>+</span> <span class='int'>7</span>
    <span class='id identifier rubyid_split'>split</span><span class='lbracket'>[</span><span class='id identifier rubyid_x'>x</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_strip!'>strip!</span>
    <span class='id identifier rubyid_split'>split</span><span class='lbracket'>[</span><span class='id identifier rubyid_x'>x</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_get_ttl'>get_ttl</span><span class='lparen'>(</span><span class='id identifier rubyid_split'>split</span><span class='lbracket'>[</span><span class='id identifier rubyid_x'>x</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='rbrace'>}</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_split'>split</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="strip_comments-instance_method">
  
    #<strong>strip_comments</strong>(line)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/dnsruby/zone_reader.rb', line 131</span>

<span class='kw'>def</span> <span class='id identifier rubyid_strip_comments'>strip_comments</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_last_index'>last_index</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='comment'>#  Are we currently in a quoted section?
</span>  <span class='comment'>#  Does a quoted section begin or end in this line?
</span>  <span class='comment'>#  Are there any semi-colons?
</span>  <span class='comment'>#  Ary any of the semi-colons inside a quoted section?
</span>  <span class='comment'>#  Handle escape characters
</span>  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\\</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_strip_comments_meticulously'>strip_comments_meticulously</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>while</span> <span class='lparen'>(</span><span class='id identifier rubyid_next_index'>next_index</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_last_index'>last_index</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='comment'>#  Have there been any quotes since we last looked?
</span>    <span class='id identifier rubyid_process_quotes'>process_quotes</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='lbracket'>[</span><span class='id identifier rubyid_last_index'>last_index</span><span class='comma'>,</span> <span class='id identifier rubyid_next_index'>next_index</span> <span class='op'>-</span> <span class='id identifier rubyid_last_index'>last_index</span><span class='rbracket'>]</span><span class='rparen'>)</span>

    <span class='comment'>#  Now use @in_quoted_section to work out if the &#39;;&#39; terminates the line
</span>    <span class='kw'>if</span> <span class='lparen'>(</span><span class='op'>!</span><span class='ivar'>@in_quoted_section</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='id identifier rubyid_line'>line</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='id identifier rubyid_next_index'>next_index</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_last_index'>last_index</span> <span class='op'>=</span> <span class='id identifier rubyid_next_index'>next_index</span>
  <span class='kw'>end</span>
  <span class='comment'>#  Check out the quote situation to the end of the line
</span>  <span class='id identifier rubyid_process_quotes'>process_quotes</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='lbracket'>[</span><span class='id identifier rubyid_last_index'>last_index</span><span class='comma'>,</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_line'>line</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="strip_comments_meticulously-instance_method">
  
    #<strong>strip_comments_meticulously</strong>(line)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/dnsruby/zone_reader.rb', line 158</span>

<span class='kw'>def</span> <span class='id identifier rubyid_strip_comments_meticulously'>strip_comments_meticulously</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span>
  <span class='comment'>#  We have escape characters in the text. Go through it character by
</span>  <span class='comment'>#  character and work out what&#39;s escaped and quoted and what&#39;s not
</span>  <span class='id identifier rubyid_escaped'>escaped</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_quoted'>quoted</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_pos'>pos</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_each_char'>each_char</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_c'>c</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\\</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_escaped'>escaped</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_escaped'>escaped</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_escaped'>escaped</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_escaped'>escaped</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_c'>c</span> <span class='op'>&gt;=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>&lt;=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>9</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='comment'># rfc 1035 5.1 \DDD
</span>          <span class='id identifier rubyid_pos'>pos</span> <span class='op'>=</span> <span class='id identifier rubyid_pos'>pos</span> <span class='op'>+</span> <span class='int'>2</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_escaped'>escaped</span> <span class='op'>=</span> <span class='kw'>false</span>
        <span class='kw'>next</span>
      <span class='kw'>else</span>
        <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_c'>c</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
          <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_quoted'>quoted</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_quoted'>quoted</span> <span class='op'>=</span> <span class='kw'>false</span>
          <span class='kw'>else</span>
            <span class='id identifier rubyid_quoted'>quoted</span> <span class='op'>=</span> <span class='kw'>true</span>
          <span class='kw'>end</span>
        <span class='kw'>else</span>
          <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_c'>c</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
            <span class='kw'>if</span> <span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_quoted'>quoted</span><span class='rparen'>)</span>
              <span class='kw'>return</span> <span class='id identifier rubyid_line'>line</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_pos'>pos</span><span class='op'>+</span><span class='int'>1</span><span class='rbracket'>]</span>
            <span class='kw'>end</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_pos'>pos</span> <span class='op'>+=</span><span class='int'>1</span>
  <span class='rbrace'>}</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_line'>line</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Fri Apr  9 10:58:13 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.26 (ruby-3.0.0).
</div>

    </div>
  </body>
</html>